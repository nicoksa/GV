@page
@model GV.Pages.PropertiesUrbanoModel
@{
    ViewData["Title"] = "División Urbano";
}




<link rel="stylesheet" href="css/styleProperties.css" />


<br />


<div class="site-section site-section-sm bg-light">
    <div class="container">

        <!-- Filtros - Versión clásica  -->
        <div class="row mb-5 justify-content-center">
            <div class="col-lg-10">
                <div class="property-filter-container bg-white p-4 shadow-sm">
                    <div class="filter-header text-center mb-4">
                        <h3 class="filter-title position-relative d-inline-block mb-4"
                            style="font-family: 'Oswald', sans-serif; font-weight: 300; letter-spacing: 1px; color: #333;">
                            BUSCAR PROPIEDADES
                        </h3>
                    </div>

                    <form class="filter-form" method="get">
                        <div class="row g-3 mb-3">
                            <div class="col-md-3">
                                <div class="filter-group">
                                    <label for="property-type" class="form-label small text-muted mb-1">TIPO DE PROPIEDAD</label>
                                    <select class="form-select border-1" id="property-type" name="Tipo">
                                        <option value="">Todos</option>
                                        <option value="Casa" selected="@(Model.Tipo == "Casa")">Casa</option>
                                        <option value="Departamento" selected="@(Model.Tipo == "Departamento")">Departamento</option>
                                        <option value="Local" selected="@(Model.Tipo == "Local")">Local</option>
                                        <option value="Quinta" selected="@(Model.Tipo == "Quinta")">Quinta</option>
                                        <option value="Terreno" selected="@(Model.Tipo == "Terreno")">Terreno</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="filter-group">
                                    <label for="location" class="form-label small text-muted mb-1">CIUDAD</label>
                                    <select class="form-select border-1" id="location" name="Ubicacion">
                                        <option value="">Todas</option>
                                        <option value="Saladillo" selected="@(Model.Ubicacion == "Saladillo")">Saladillo</option>
                                        <option value="25 de Mayo" selected="@(Model.Ubicacion == "25 de Mayo")">25 de Mayo</option>
                                        <option value="Las Flores" selected="@(Model.Ubicacion == "Las Flores")">Las Flores</option>
                                        <option value="Roque Pérez" selected="@(Model.Ubicacion == "Roque Pérez")">Roque Pérez</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="filter-group">
                                    <label for="dormitorios" class="form-label small text-muted mb-1">DORMITORIOS</label>
                                    <select class="form-select border-1" id="dormitorios" name="Dormitorios">
                                        <option value="">Cualquiera</option>
                                        <option value="1" selected="@(Model.Dormitorios == 1)">1</option>
                                        <option value="2" selected="@(Model.Dormitorios == 2)">2</option>
                                        <option value="3" selected="@(Model.Dormitorios == 3)">3</option>
                                        <option value="4" selected="@(Model.Dormitorios >= 4)">4+</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-md-3 d-flex align-items-end">
                                <button type="submit" class="btn btn-dark w-100 py-2">
                                    <i class="fas fa-search me-2"></i> Buscar
                                </button>
                            </div>
                        </div>

                        <div class="advanced-filters mt-3">
                            <div class="row g-3">
                                <div class="col-md-12">
                                    <!-- Cambiado a col-md-12 para usar todo el ancho -->
                                    <div class="row g-2">
                                        <!-- Precio Mínimo (25% del ancho) -->
                                        <div class="col-md-3">
                                            <label for="min-price" class="form-label small text-muted mb-1">PRECIO MÍNIMO</label>
                                            <div class="input-group">
                                                <span class="input-group-text" style="font-size: 0.8rem; padding: 0.375rem 0.5rem; height: calc(2.25rem + 2px);">U$S</span>
                                                <input type="number" class="form-control" id="min-price" name="PrecioMin" style="height: calc(2.25rem + 2px)"
                                                       placeholder="Mínimo" min="0" step="1000" value="@Model.PrecioMin">
                                            </div>
                                        </div>

                                        <!-- Precio Máximo (25% del ancho) -->
                                        <div class="col-md-3">
                                            <label for="max-price" class="form-label small text-muted mb-1">PRECIO MÁXIMO</label>
                                            <div class="input-group">
                                                <span class="input-group-text" style="font-size: 0.8rem; padding: 0.375rem 0.5rem; height: calc(2.25rem + 2px);">U$S</span>
                                                <input type="number" class="form-control" id="max-price" name="PrecioMax" style="height: calc(2.25rem + 2px)"
                                                       placeholder="Máximo" min="0" step="1000" value="@Model.PrecioMax">
                                            </div>
                                        </div>

                                        <!-- Ambientes Mínimos (25% del ancho) -->
                                        <div class="col-md-3">
                                            <label for="ambients" class="form-label small text-muted mb-1" >AMBIENTES </label>
                                            <select class="form-select" id="ambients" name="Ambientes" style="height: calc(2.25rem + 2px)">
                                                <option value="">Cualquiera</option>
                                                <option value="1" selected="@(Model.Ambientes == 1)">1</option>
                                                <option value="2" selected="@(Model.Ambientes == 2)">2</option>
                                                <option value="3" selected="@(Model.Ambientes == 3)">3</option>
                                                <option value="4" selected="@(Model.Ambientes >= 4)">4+</option>
                                            </select>
                                        </div>

                                        <!-- Baños Mínimos (25% del ancho) -->
                                        <div class="col-md-3">
                                            <label for="banios" class="form-label small text-muted mb-1">BAÑOS </label>
                                            <select class="form-select" id="banios" name="Banios" style="height: calc(2.25rem + 2px)">
                                                <option value="">Cualquiera</option>
                                                <option value="1" selected="@(Model.Banios == 1)">1</option>
                                                <option value="2" selected="@(Model.Banios == 2)">2</option>
                                                <option value="3" selected="@(Model.Banios == 3)">3</option>
                                                <option value="4" selected="@(Model.Banios == 4)">4+</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--  
                        <div class="text-center mt-4">
                            <a class="toggle-advanced-filters text-decoration-none text-muted" data-bs-toggle="collapse" href=".advanced-filters" role="button">
                                <span class="filter-toggle-text">Más opciones de búsqueda</span>
                                <i class="fas fa-chevron-down ms-2 small"></i>
                            </a>
                        </div>
                        -->

                    </form>
                </div>
            </div>
        </div>


        <!-- Nueva sección de header con contador y ordenamiento -->
        <div class="row mb-4">
            <!-- Contador de resultados a la izquierda -->
            <div class="col-md-6">
                <div class="results-count">
                    <strong>@Model.TotalItems</strong> resultados encontrados
                </div>
            </div>

            <!-- Selector de ordenamiento a la derecha -->
        <div class="col-md-6 text-end">
            <div class="sorting-options">
                <form method="get" class="d-inline">
                    <!-- Mantener los parámetros de filtro existentes -->
                    <input type="hidden" name="Tipo" value="@Model.Tipo" />
                    <input type="hidden" name="Ubicacion" value="@Model.Ubicacion" />
                    <input type="hidden" name="Dormitorios" value="@Model.Dormitorios" />
                    <input type="hidden" name="PrecioMin" value="@Model.PrecioMin" />
                    <input type="hidden" name="PrecioMax" value="@Model.PrecioMax" />
                    <input type="hidden" name="Banios" value="@Model.Banios" />
                    <input type="hidden" name="Ambientes" value="@Model.Ambientes" />

                    <select name="sortOrder" onchange="this.form.submit()" class="form-select form-select-sm d-inline-block w-auto">
                        <option value="">Ordenar por</option>
                        <option value="precio_asc" selected="@(Model.SortOrder == "precio_asc")">Precio (Menor a Mayor)</option>
                        <option value="precio_desc" selected="@(Model.SortOrder == "precio_desc")">Precio (Mayor a Menor)</option>
                        <option value="dormitorios_asc" selected="@(Model.SortOrder == "dormitorios_asc")">Dormitorios (Menor a Mayor)</option>
                        <option value="dormitorios_desc" selected="@(Model.SortOrder == "dormitorios_desc")">Dormitorios (Mayor a Menor)</option>
                    </select>
                </form>
            </div>
        </div>

            @foreach (var p in Model.Resultados)
            {
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="property-entry h-100">
                        <a asp-page="/Property" class="property-thumbnail">
                            <div class="offer-type-wrap">
                                <span class="offer-type bg-success">@p.Tipo</span>
                            </div>
                            <img src="@p.Imagenes?.FirstOrDefault()?.Url" alt="@p.Titulo" class="img-fluid">
                        </a>
                        <div class="p-4 property-body">
                            <h2 class="property-title">
                                <a asp-page="/Property">@p.Titulo</a>
                            </h2>
                            <div class="property-location mb-3">
                                <i class="fas fa-map-marker-alt text-success mr-2"></i>
                                <span>@p.Ubicacion</span>
                            </div>
                            <strong class="property-price text-primary mb-3 d-block text-success">U$S @p.Precio</strong>
                            <ul class="property-specs-wrap mb-3 mb-lg-0">
                                <li>
                                    <span class="property-specs">Dormitorios</span>
                                    <span class="property-specs-number">@p.Dormitorios</span>
                                </li>
                                <li>
                                    <span class="property-specs">Baños</span>
                                    <span class="property-specs-number">@p.Banios</span>
                                </li>
                                <li>
                                    <span class="property-specs">m²</span>
                                    <span class="property-specs-number">@p.SuperficieTotal</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            }
                 

        </div>

        <div class="row">
            <div class="col-md-12 text-center">
                <div class="site-pagination">
                    @* Botón Anterior *@
                    @if (Model.ShowPrevious)
                    {
                        <a asp-route-currentpage="@(Model.CurrentPage - 1)"
                            asp-route-tipo="@Model.Tipo"
                            asp-route-ubicacion="@Model.Ubicacion"
                            asp-route-dormitorios="@Model.Dormitorios"
                            asp-route-preciomin="@Model.PrecioMin"
                            asp-route-preciomax="@Model.PrecioMax"
                            asp-route-ambientes="@Model.Ambientes"
                            asp-route-banios="@Model.Banios">
                            &laquo;
                        </a>
                    }

                    @* Números de página *@
                    @{
                        int startPage = Math.Max(1, Model.CurrentPage - 2);
                        int endPage = Math.Min(Model.TotalPages, Model.CurrentPage + 2);

                        if (startPage > 1)
                        {
                            <a asp-route-currentpage="1"
                                asp-route-tipo="@Model.Tipo"
                                asp-route-ubicacion="@Model.Ubicacion"
                                asp-route-dormitorios="@Model.Dormitorios"
                                asp-route-preciomin="@Model.PrecioMin"
                                asp-route-preciomax="@Model.PrecioMax"
                                asp-route-ambientes="@Model.Ambientes"
                                asp-route-banios="@Model.Banios"
                                class="@(1 == Model.CurrentPage ? "active" : "")">
                                1
                            </a>
                            if (startPage > 2)
                            {
                                <span>...</span>
                            }
                        }

                        for (int i = startPage; i <= endPage; i++)
                        {
                            <a asp-route-currentpage="@i"
                                asp-route-tipo="@Model.Tipo"
                                asp-route-ubicacion="@Model.Ubicacion"
                                asp-route-dormitorios="@Model.Dormitorios"
                                asp-route-preciomin="@Model.PrecioMin"
                                asp-route-preciomax="@Model.PrecioMax"
                                asp-route-ambientes="@Model.Ambientes"
                                asp-route-banios="@Model.Banios"
                                class="@(i == Model.CurrentPage ? "active" : "")">
                                @i
                            </a>
                        }

                        if (endPage < Model.TotalPages)
                        {
                            if (endPage < Model.TotalPages - 1)
                            {
                                <span>...</span>
                            }
                            <a asp-route-currentpage="@Model.TotalPages"
                                asp-route-tipo="@Model.Tipo"
                                asp-route-ubicacion="@Model.Ubicacion"
                                asp-route-dormitorios="@Model.Dormitorios"
                                asp-route-preciomin="@Model.PrecioMin"
                                asp-route-preciomax="@Model.PrecioMax"
                                asp-route-ambientes="@Model.Ambientes"
                                asp-route-banios="@Model.Banios"
                                class="@(Model.TotalPages == Model.CurrentPage ? "active" : "")">
                                @Model.TotalPages
                            </a>
                        }
                    }

                    @* Botón Siguiente *@
                    @if (Model.ShowNext)
                    {
                        <a asp-route-currentpage="@(Model.CurrentPage + 1)"
                            asp-route-tipo="@Model.Tipo"
                            asp-route-ubicacion="@Model.Ubicacion"
                            asp-route-dormitorios="@Model.Dormitorios"
                            asp-route-preciomin="@Model.PrecioMin"
                            asp-route-preciomax="@Model.PrecioMax"
                            asp-route-ambientes="@Model.Ambientes"
                            asp-route-banios="@Model.Banios">
                            &raquo;
                        </a>
                    }
                </div>

                    @* Texto simplificado con el conteo *@
                <div class="mt-2 small text-muted" style="margin-top: 15px !important;">
                    Mostrando @Model.Resultados.Count de @Model.TotalItems propiedades
                </div>
            </div>
        </div>
          
    </div>
</div>










